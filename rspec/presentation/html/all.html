<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>rSpec</title>
<!-- metadata -->
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="&date" />
<meta name="author" content="Marcos Piccinini" />
<meta name="organization" content="&organization;" />
<meta name="company" content="The Pragmatic Programmers, LLC" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="../ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="../ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="../lib/stylesheets/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="../ui/default/opera.css" type="text/css" media="projection" id="operaFix" />

<link rel="stylesheet" href="../lib/stylesheets/pressie.css" type="text/css" />

<!-- S5 JS -->
<script src="../ui/default/slides.js" type="text/javascript"></script>

<!-- Syntax Highlighter -->
<link rel="stylesheet"  href="../dp.SyntaxHighlighter/Styles/SyntaxHighlighter.css"></link>

</head>
<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h2>Copyright &copy; 2008 Dave Thomas</h2>
</div>

</div>


<div class="presentation">
<div class="slide">
<h1>rSpec</h1>
<blockquote>
<p>Marcos Piccinini</p>
</blockquote>
</div>
<div class="slide">
<h1>Contents</h1>
<div style="font-size: 70%">
<ul>
	<li>rSpec</li>
</ul>
<ul>
	<li>Including Code in Slides</li>
</ul>
<ul>
	<li>Building and Displaying <span class="caps">HTML</span> Slides</li>
</ul>
<ul>
	<li>An Example</li>
</ul>
</div>
</div>
<div class="title slide">
<h1>rSpec</h1>
<ul>
	<li>Ruby</li>
</ul>
</div>
<div class="slide">
<h1>Por que &#8220;testar&#8221;?</h1>
<ul>
	<li>Porque sim.</li>
	<li>rSpec vs Test Unit</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">AAAARR</span> quem?</h1>
<ul>
	<li>Framework <span class="caps">BDD</span> ( Behavior Driven Development )</li>
	<li>rSpec vs Test Unit</li>
</ul>
</div>
<div class="slide">
<h1>Por que &#8220;testar&#8221;?</h1>
<ul>
	<li>Porque sim.</li>
	<li>rSpec vs Test Unit</li>
</ul>
</div>
<div class="slide">
<h1>Filosofia</h1>
<ul>
	<li>Clareza</li>
	<li>Passos pequenos</li>
	<li>Seja um consumidor do seu codigo</li>
</ul>
</div>
<div class="slide">
<h1>Instalando</h1>
<ul>
	<li>sudo gem install rspec ZenTest</li>
</ul>
</div>
<div class="slide">
<h1>Comandos</h1>
<ul>
	<li>describe</li>
	<li>it</li>
</ul>
<p>Rodando:</p>
<ul>
	<li>spec <arquivo> <arquivo></li>
	<li>rake</li>
	<li>autotest (ZenTest)<br />
  <br />
</div><br />
<div class="slide"></li>
</ul>
<h1>&#8220;Should&#8221;</h1>
<ul>
	<li>should</li>
	<li>should_not</li>
	<li>should eql() ou ==</li>
	<li>should be_#{metodo}</li>
	<li>should have(N).coisas</li>
	<li>should match(/regex/)</li>
	<li>should raise_error</li>
	<li>should respond_to</li>
</ul>
</div>
<div class="slide">
<h1>Algo de Podre no Reino da Ciberdelia</h1>
<ul>
	<li>Classe A usa Classe B.</li>
	<li>Testar uma view ou um controller.</li>
</ul>
</div>
<div class="slide">
<h1>Mocks e Stubs</h1>
<p>TO <span class="caps">THE</span> <span class="caps">RESCUE</span>!</p>
<ul>
	<li><span class="caps">MOCK</span> =&gt; <span class="caps">CLASSE</span> do Paraguay.</li>
</ul>
<ul>
	<li><span class="caps">STUB</span> =&gt; <span class="caps">METODO</span> do Paraguay.</li>
</ul>
<p>obj = mock(Modelo)</p>
<p>obj.stub!(:metodo)</p>
<p>obj.stub!(:metodo).and_return(x)</p>
<p>obj = mock(Modelo, :metodo =&gt; x)</p>
</div>
<div class="slide">
<h1>Rspec no Rails</h1>
<ul>
	<li>./script/plugin install git://github.com/dchelimsky/rspec-rails.git</li>
	<li>./script/generate rspec</li>
	<li>./script/generate rspec_scaffold Model (rspec_model, rspec_controller)_</li>
</ul>
</div>
<div class="slide">
<h1>RCov</h1>
<ul>
	<li>rake spec:rcov</li>
	<li>go <span class="caps">TDD</span>/<span class="caps">BDD</span>!<br />
</div><br />
<div class="slide"></li>
</ul>
<h1 class="slide0">Including Code in Slides</h1>
</div>
<div class="slide">
<h1>Including Code in Slides</h1>
<ul>
	<li>Write code under <code>code/</code></li>
	<li>Include it in your slides using <code>:code</code> directives</li>
</ul>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

:code code/myfile.rb
</pre></div>
<ul>
	<li>The entire contents of <code>code/myfile.rb</code> will be included in the slide</li>
</ul>
</div>
<div class="slide">
<h1>Including Parts of a Source File</h1>
<ul>
	<li>In the source file, use comments containing <code>START:sometag</code> and <code>END:sometag</code></li>
</ul>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

class SomeClass
#START:useful-method
  def my_method
    puts "hello world"
  end
#END:useful-method
end
</pre></div>
<ul>
	<li>In the slide, reference the tag in square brackets after the file name</li>
</ul>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

:code code/myfile.rb[useful-method]
</pre></div>
</div>
<div class="slide">
<h1>Merge Multiple Fragments</h1>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

#START:constructor
class SomeClass

  def initialize
    # ...
  end
#END:constructor
     
  def other_methods...
  end
#START:constructor
end
#END:constructor
</pre></div>
</div>
<div class="slide">
<h1>Override Code Language and/or <span class="caps">CSS</span> Class</h1>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

:code code/file.xxx[section lang=name class=name]
</pre></div>
<ul>
	<li>can appear in any order</li>
	<li><code>lang=</code><em>anything supported by SyntaxHighlighter</em>
	<ul>
		<li>look in <code>dp.SyntaxHighlighter/Scripts</code>)</li>
	</ul></li>
	<li><code>class=code-large | code-normal | code-small | code-tiny | code-supertiny</code><br />
                                                                                  <br />
</div><br />
<div class="slide"></li>
</ul>
<h1>Embedding Code Inline</h1>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

 :inlinecode
 code that
 goes inline in slides
 :endinlinecode
</pre></div>
<ul>
	<li><code>:inlinecode</code> optionally takes <code>lang=xxx</code> and <code>class=xx</code></li>
</ul>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">

 :inlinecode lang=ruby
    puts "Hello World!"
 :endinlinecode
</pre></div>
</div>
<div class="title slide">
<h1>Building and Displaying <span class="caps">HTML</span> Slides</h1>
</div>
<div class="slide">
<h1>Building <span class="caps">HTML</span> Slides</h1>
<ul>
	<li>Given an individual section in <code>slides/xxx.slides</code></li>
</ul>
<code>rake html/xxx.html</code>
<ul>
	<li>If you&#8217;ve created a <code>slide/table_of_contents.slides</code>, build the whole presentation with</li>
</ul>
<code>rake all</code>
The output will be in <code>html/all.html</code>
</div>
<div class="slide">
<h1>Running the Presentation</h1>
<ul>
	<li>Simply open the appropriate <span class="caps">HTML</span> file</li>
</ul>
<ul>
	<li>See the <a href="http://meyerweb.com/eric/tools/s5/">S5 documentation</a> for details</li>
</ul>
<ul>
	<li>Some hints
	<ul>
		<li>arrow keys and space bar work</li>
		<li>type the slide number to jump</li>
		<li>mouse over the bottom right to bring up a set of controls and a list of all available slides</li>
		<li>most IR and radio clickers seem to work OK</li>
		<li>resizing your browser fonts works well to make stuff fit during the presentation</li>
	</ul></li>
</ul>
</div>
<div class="title slide">
<h1>An Example</h1>
<p>This comes from the <a href="http://pragmaticstudio.com/ruby/">Advanced Ruby Course</a></p>
</div>
<div class="slide">
<h1>Continuation</h1>
<div style="width: 50%; float: right">
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">def open_box(continuation)
  continuation.call if rand &lt; 0.5
end

callcc do |continuation|
  puts "opening box"
  open_box(continuation)
  puts "Phew--kitty's OK"
end

puts "closing box"</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/basic_continuation.rb">code/control/basic_continuation.rb</a></div></p>
</div>
<div style="width: 50%">
<ul>
	<li>Construct using <code>callcc</code>
	<ul>
		<li>pass it a block</li>
		<li>block receives <code>Continuation</code> object</li>
		<li>invoke that object&#8217;s <code>call</code> method, and control passes to the end of that block</li>
	</ul></li>
</ul>
</div>
</div>
<div class="slide">
<h1>Continuations Are Closures</h1>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">def create_continuation(arg)
  callcc { |continuation| return continuation }
  puts "Back in method: arg = #{arg}"
  exit
end

cont_one = create_continuation(123)
cont_one.call      #=&gt; Back in method: arg = 123</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/closure_continuation.rb">code/control/closure_continuation.rb</a></div></p>
</div>
<div class="slide">
<h1>But&#8230;</h1>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">def create_continuation(arg)
  callcc { |continuation| return continuation }
  puts "Back in method: arg = #{arg}"
end

cont_one = create_continuation(123)
cont_one.call

### Results in:
#
# Back in method: arg = 123
# closure_continuation_2.rb:8: undefined method `call' for nil:NilClass
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/closure_continuation_2.rb">code/control/closure_continuation_2.rb</a></div></p>
</div>
<div class="slide">
<h1>But&#8230;</h1>
<div>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">def create_continuation(arg)
  callcc { |continuation| return continuation }
  puts "Back in method: arg = #{arg}"
end

cont_one = create_continuation(123)
cont_one.call

### Results in:
#
# Back in method: arg = 123
# closure_continuation_2.rb:8: undefined method `call' for nil:NilClass
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/closure_continuation_2.rb">code/control/closure_continuation_2.rb</a></div></p>
<div style="position: relative; left: 60%; top: -3em; font-size: 400%; color: #6b6">Why?</div>
</div>
</div>
<div class="slide">
<h1>Implementing throw&#8230;catch</h1>
<p>Let&#8217;s try to implement throw and catch so that the following works as expected:</p>
<div class="code-normal">
<pre name="code" class="ruby:nogutter:nocontrols">def test_method
  CC.throw(:x, "thrown X") if rand &lt; 0.5
end

result = CC.catch(:x) do
          test_method
          "normal exit"
        end
        
puts "Result is #{result}"
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/cc_throw_catch.rb">code/control/cc_throw_catch.rb</a></div></p>
</div>
<div class="slide">
<h1>Implementing throw&#8230;catch</h1>
<ul>
	<li>We need a thread-local stack of all current catch blocks</li>
</ul>
<ul>
	<li>When we see a <code>catch</code>, we store the symbol and a continuation for the block on the stack. If that continuation gets called, execution resumes after the block (which is what <code>catch</code> does)</li>
</ul>
<ul>
	<li>When we see a <code>throw</code> we traverse it looking for the entry<br />
with the corresponding system.</li>
</ul>
<ul>
	<li>When we find that entry, we call the corresponding continuation</li>
</ul>
<p>&nbsp;</p>
<blockquote style="font-size=&quot;50%&quot;;">
<p style="font-size=&quot;50%&quot;;">This implementation is based on code from Jim Weirich</p>
</blockquote>
</div>
<div class="slide">
<h1>Catch and Throw</h1>
<div class="code-tiny">
<pre name="code" class="ruby:nogutter:nocontrols">module CC
  CATCH_STACK = CatchStack.new
  
  def self.catch(sym)
    callcc do |cc|
      CATCH_STACK.wrap(sym, cc) do
        yield 
      end
    end
  end
  
  def self.throw(sym, value=nil)
    cc = CATCH_STACK.find_continuation_for(sym)
    cc.call(value)
  end
end
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/cc_throw_catch.rb">code/control/cc_throw_catch.rb</a></div></p>
</div>
<div class="slide">
<h1>And the stack</h1>
<div class="code-tiny">
<pre name="code" class="ruby:nogutter:nocontrols">class CatchStack
  Frame = Struct.new(:symbol, :cc)
  
  def stack
    Thread.current[:catch_stack] ||= []
  end
  
  def wrap(symbol, cc)
    stack &lt;&lt; Frame.new(symbol, cc)
    begin
      yield
    ensure
      stack.pop
    end
  end
  
  def find_continuation_for(symbol)
      stack.pop until stack.empty? || stack.last.symbol == symbol
      if stack.empty?
        fail NameError, "uncaught throw `#{sym}'"
      else
        stack.pop.cc
      end
  end
end
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Volumes/osx/git/os/screencast_br/rspec/presentation/code/control/cc_throw_catch.rb">code/control/cc_throw_catch.rb</a></div></p>
</div>
<div class="slide">
<h1>Continuations.</h1>
<ul>
	<li>Can&#8217;t invoke across threads</li>
</ul>
<ul>
	<li>Can carry stale state around with them</li>
</ul>
<ul>
	<li>Can use up a lot of memory</li>
</ul>
<ul>
	<li>Are not fun to debug</li>
</ul>
<p>But&#8230;</p>
<ul>
	<li>They&#8217;ll impress your friends</div></li>
</ul>

  <!-- Syntax Highlighter -->
  <script language="javascript" src="../dp.SyntaxHighlighter/Scripts/shCore.js"></script>
  <script language="javascript" src="../dp.SyntaxHighlighter/Scripts/shBrushCpp.js"></script>
  <script language="javascript" src="../dp.SyntaxHighlighter/Scripts/shBrushRuby.js"></script>
  <script language="javascript" src="../dp.SyntaxHighlighter/Scripts/shBrushXml.js"></script>
  <script language="javascript">
  dp.SyntaxHighlighter.ClipboardSwf = '/flash/clipboard.swf';
  dp.SyntaxHighlighter.HighlightAll('code');
  </script>
</div>
</body>
</html>
